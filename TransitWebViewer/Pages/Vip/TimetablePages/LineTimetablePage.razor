@page "/vip/timetables/line"
@using Timetable
@using TransitWebViewer.Components.Timetables.LineTimetable
@using TransitWebViewer.Components.Timetables.Selectors
@using VipTimetable

<h3>ViP - Linienfahrpl√§ne</h3>

@code
{
    [Parameter, SupplyParameterFromQuery(Name = "date")]
    public DateTime? QueryDate { get; init; }

    [Parameter, SupplyParameterFromQuery(Name = "line")]
    public string[] QueryLineIdentifier { get; init; } = [];

    [Parameter, SupplyParameterFromQuery(Name = "route")]
    public string[] QueryRouteIndices { get; init; } = [];

    [Parameter, SupplyParameterFromQuery(Name = "days")]
    public int? QueryDays { get; init; }

    [Parameter, SupplyParameterFromQuery(Name = "collapse-trips")]
    public bool? QueryCollapseTrips { get; init; }

    private static IHistoryEntry? HistoryEntry { get; set; } = null;

    private static DaysOfOperation Days { get; set; } = DaysOfOperation.Daily;

    private static bool CollapseTrips { get; set; } = true;

    private static IReadOnlyCollection<Line.Trip> Trips { get; set; } = [];
}

<div class="button-group">
    <HistoryEntrySelector InitialDate="QueryDate is {} date ? DateOnly.FromDateTime(date) : DateOnly.FromDateTime(DateTime.Now)" OnUpdate="historyEntry => { HistoryEntry = historyEntry; Trips = []; StateHasChanged(); }" />

    <DaySelector InitialDays="QueryDays" OnUpdate="days => { Days = days; StateHasChanged(); }" />
    <BooleanSelector Initial="QueryCollapseTrips" QueryParameterName="collapse-trips" OnUpdate="collapseTrips => { CollapseTrips = collapseTrips; StateHasChanged(); }" Text="Fasse im Takt verkehrende Fahrten zusammen" />
</div>

@if (HistoryEntry is not null)
{
    <div class="button-group pt-1">
        <TripSelector InitialLineIdentifier="@QueryLineIdentifier" InitialRoutes="QueryRouteIndices" HistoryEntry="HistoryEntry" OnUpdate="trips => { Trips = trips; StateHasChanged(); }" ReferenceCity="Cities.Potsdam"/>
    </div>
}

<hr/>

<LineTimetable Trips="Trips" Days="Days" CollapseTrips="CollapseTrips" DayOfTimetable="HistoryEntry?.EffectiveDate ?? new DateOnly()" ReferenceCity="Cities.Potsdam" />
