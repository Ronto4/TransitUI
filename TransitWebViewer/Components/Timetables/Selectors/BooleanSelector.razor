@implements ISelector<bool>
@inject NavigationManager Navigation

<div class="form-check-inline">
    <input class="form-check-input" type="checkbox" value="" checked="@Checked" id="checkbox-@GuidForId" @onchange="e => { Checked =  e.Value is true; EmitUpdate(); }">
    <label class="form-check-label" for="checkbox-@GuidForId">
        @Text
    </label>
</div>

@code {
    [Parameter, EditorRequired] public required string Text { get; init; }
    [Parameter, EditorRequired] public required Action<bool> OnUpdate { get; init; }
    [Parameter, EditorRequired] public required bool? Initial { get; init; }
    [Parameter, EditorRequired] public required string QueryParameterName { get; init; }
    protected override void OnInitialized()
    {
        if (Initial is { } initial)
        {
            Checked = initial;
            EmitUpdate();
        }
    }

    private bool Checked { get; set; }
    private Guid GuidForId { get; } = Guid.NewGuid();

    private void EmitUpdate()
    {
        OnUpdate(Checked);
        Navigation.NavigateTo(Navigation.GetUriWithQueryParameter(QueryParameterName, Checked));
    }
}
